(function(){function t(e){var t=$('div [class*="window-header"]',$(e));t.mousedown(function(t){function n(t){var n=e.style.position;e.style.position="absolute",e.style.left=t.clientX+window.pageXOffset-e.innerX+"px",e.style.top=t.clientY+window.pageYOffset-e.innerY+"px",e.style.position=n}e.innerX=t.clientX+window.pageXOffset-e.offsetLeft,e.innerY=t.clientY+window.pageYOffset-e.offsetTop,window.addEventListener("mousemove",n,!1),window.addEventListener("mouseup",function(){window.removeEventListener("mousemove",n,!1)},!0)})}function n(e,t){var n=$('div[class*="window-resize"]',$(t));n.mousedown(function(e){function n(e){t.ow=t.offsetWidth,t.oh=t.offsetHeight;var n=e.clientX-t.startX,r=e.clientY-t.startY;t.startX+=n,t.startY+=r;var i=t.style.position;t.style.position="absolute";var s=t.ow;t.style.width=t.ow+n*.9+"px",t.style.position=i}t.startX=e.clientX,t.startY=e.clientY,window.addEventListener("mousemove",n,!1),window.addEventListener("mouseup",function(){window.removeEventListener("mousemove",n,!1)},!0)})}function a(e,t){var n=[],r=e.get(t);if(r){var i=r.eClass,s=e.eResource().get("resourceSet"),o=s.elements();n=_.filter(o,function(e){return e.eClass===i})}return n}var e=Ecore.Edit={version:"0.3.0"};e.LabelProvider={getLabel:function(e){var t=e.eClass.get("name");return this[t]?this[t](e):e.eClass.get("name")},EClass:function(e){return e.get("name")},EDataType:function(e){return e.get("name")},EEnum:function(e){return e.get("name")},EEnumLiteral:function(e){return e.get("name")+" = "+e.get("value")},EAttribute:function(e){var t=e.isSet("eType")?" : "+e.get("eType").get("name"):"";return e.get("name")+t},EReference:function(e){var t=e.isSet("eType")?" : "+e.get("eType").get("name"):"";return e.get("name")+t},EOperation:function(e){var t=e.isSet("eType")?" : "+e.get("eType").get("name"):"";return e.get("name")+"()"+t},EPackage:function(e){return e.get("name")},ResourceSet:function(e){return"resourceSet"},Resource:function(e){return e.get("uri")}},e.Window=Backbone.View.extend({_template:_.template('<div class="row-fluid"><div class="window-header"><span class="window-title"><%= title %></span><span class="window-actions"></span></div><div class="window-content"></div><div class="window-footer"></div></div>'),_resizeHandleTemplate:_.template('<div class="window-resize" style="z-index: 1000;"></div>'),_closeActionTemplate:_.template('<a href="#" class="window-action"><i class="icon-remove action-close"></i></a>'),_minimizeActionTemplate:_.template('<a href="#" class="window-action"><i class="icon-minus action-min"></i></a>'),_maximizeActionTemplate:_.template('<a href="#" class="window-action"><i class="icon-plus action-max"></i></a>'),events:{'click i[class*="action-close"]':"close",'click i[class*="action-min"]':"minimize",'click i[class*="action-max"]':"maximize"},title:"Window",draggable:!0,initialize:function(e){_.bindAll(this,"render","remove","close","minimize","maximize"),e||(e={}),this.parts=e.parts,e.title&&!this.title&&(this.title=e.title),e.height&&(this.height=e.height),e.draggable&&(this.draggable=e.draggable),e.content&&(this.content=e.content)},render:function(){this.remove();var e=this._template({title:this.title});return this.$el.addClass("window"),this.$el.css("z-index","1000"),this.$el.append(e),this.$header=$('div > div[class*="window-header"]',this.$el),$('span[class*="window-actions"]',this.$el).append(this._minimizeActionTemplate()).append(this._maximizeActionTemplate()).append(this._closeActionTemplate()),$('div[class*="window-footer"]',this.$el).append(this._resizeHandleTemplate()),this.$content=$('div > div[class*="window-content"]',this.$el),this.height&&this.$content.css("height",this.height),this.content&&(this.content.setElement(this.$content),this.content.render()),this.draggable&&t(this.$el.get()[0]),n(this,this.$el[0]),this},remove:function(){return this.$content&&this.$content.remove(),this.$el&&(this.$el.children().remove(),this.$el.css("z-index","-1")),this},close:function(){this.remove()},maximize:function(){this.$el.css("left","0"),this.$el.css("right","0")},minimize:function(){}}),e.SimpleWindow=e.Window.extend({header:_.template("<div></div>"),initialize:function(e){this.title=e.title||"Window",this.height=e.height,this.draggable=e.draggable,this.content=e.content}}),e.MenuBar=Backbone.View.extend({template:_.template('<div class="span12 action-bar btn-group"></div>'),initialize:function(e){this.buttons=e.buttons},render:function(){var e=this.template();return this.$el.append(e),_.each(this.buttons,this.renderButton,this),this},renderButton:function(e){return e.render(),$('div[class*="action-bar"]',this.$el).append(e.$el),this}}),e.MenuBarButton=Backbone.View.extend({template:_.template('<a class="btn btn-mini"> <%= label %> </a>'),events:{click:"click"},initialize:function(e){_.bindAll(this,"render","click"),this.label=e.label,this.clickHandle=e.click},render:function(){var e=this.template({label:this.label});return this.setElement(e),this},click:function(){return this.clickHandle()}}),e.MenuBarDropDownButton=e.MenuBarButton.extend({template:_.template('<a class="btn btn-mini" data-toggle="dropdown"> <%= label %> <span class="caret"> </span></a><ul class="dropdown-menu"></ul>'),initialize:function(e){_.bindAll(this,"render","click"),this.label=e.label,this.items=e.items||[],this.clickHandle=e.click},render:function(){var e=this.template({label:this.label});return this.setElement(e),this.removeItem(),_.each(this.items,this.renderItem,this),this},renderItem:function(e){return e.render(),$(this.$el[1]).append(e.$el),this},removeItem:function(e){return this.items.length=0,$(this.$el[1]).children().remove(),this},addItem:function(e){return this.items.push(e),this}}),e.Separator=Backbone.View.extend({template:_.template('<li class="divider"></li>'),render:function(){var e=this.template();return this.setElement(e),this}}),e.DropDownItem=Backbone.View.extend({template:_.template('<li><a tabindex="-1" href="#"><%= label %></a></li>'),events:{"click a":"click"},initialize:function(e){_.bindAll(this,"render","click"),this.label=e.label,this.handleClick=e.click},render:function(){var e=this.template({label:this.label});return this.setElement(e),this},click:function(){return this.handleClick()},remove:function(){}});var r=Backbone.View.extend({template:_.template("<div contenteditable><%= value %></div>"),render:function(){var e=this.template({value:this.model});this.setElement(e);var t=this;return this.$el.on("change",function(){t.trigger("change",t.$el.text())}),this}}),i=Backbone.View.extend({}),s=Backbone.View.extend({templateOptions:_.template("<% _.each(options, function(option) { %> <option> <%= option.eClass ? Ecore.Edit.LabelProvider.getLabel(option) : option %></option> <% }); %>"),initialize:function(e){this.value=e.value,this.options=e.options},render:function(){var t=this.templateOptions({options:this.options});this.$el.append(t);if(this.value===!0||this.value===!1)this.$el.val(""+this.value);else{var n=this.value?this.value.eClass?e.LabelProvider.getLabel(this.value):this.value:null;this.$el.val(n)}var r=this;return this.$el.change(function(){var e=$("option:selected",r.$el).val();r.trigger("change",e)}),this}}),o=s.extend({template:_.template("<select></select>"),initialize:function(e){s.prototype.initialize.apply(this,[e])},render:function(){var e=this.template();return this.setElement(e),s.prototype.render.apply(this),this}}),u=s.extend({template:_.template('<select multiple="multiple"></select>'),templateActions:_.template('<div class="btn-group"></div>'),templateAddAction:_.template('<a class="btn-mini"><i class="icon-plus"></i></a>'),templateDelAction:_.template('<a class="btn-mini"><i class="icon-remove"></i></a>'),initialize:function(e){s.prototype.initialize.apply(this,[e])},render:function(){var e=this.template();this.setElement(e),s.prototype.render.apply(this);var t=$(document.createElement("div"));return t.append(this.$el),this.setElement(t),this}});e.PropertyRowView=Backbone.View.extend({propertyTemplate:_.template("<tr><td><%= name %></td></tr>"),valueTemplate:_.template("<td></td>"),initialize:function(e){_.bindAll(this,"renderEReference","renderEAttribute","renderEAttributeBoolean","render"),_.isObject(this.model.eFeature)?(this.eFeature=this.model.eFeature,this.eFeatureName=this.eFeature.get("name"),this.eType=this.eFeature.get("eType")):this.eFeatureName=this.model.eFeature,this.value=this.model.value,this.model.options?this.options=this.model.options:this.eFeature.get("upperBound")!==1?this.options=this.model.eObject.get(this.eFeatureName).array():this.options=a(this.model.eObject,this.eFeature)},renderEAttribute:function(e,t,n){var i;return t.get("many")||(t.get("eType")===Ecore.EBoolean?i=this.renderEAttributeBoolean(e,t,n||!1):(i=new r({model:n}),i.on("change",function(n){e.set(t.get("name"),n),e.trigger("change"),e.eResource().trigger("change",e)}))),i},renderEAttributeBoolean:function(e,t,n){var r=new o({options:["true","false"],value:n});return r.on("change",function(n){e.set(t.get("name"),n),e.trigger("change"),e.eResource().trigger("change",e)}),r},renderEReference:function(e,t,n){var r;return t.get("upperBound")!==1?r=new u({value:n,options:this.options}):r=new o({value:n,options:this.options}),r},render:function(){var e=this.model.eObject,t=this.value||e.get(this.eFeatureName),n=this.propertyTemplate({name:this.eFeatureName}),r;this.setElement(n),this.eFeature?this.eFeature.isTypeOf("EAttribute")?r=this.renderEAttribute(e,this.eFeature,t):r=this.renderEReference(e,this.eFeature,t):(r=new o({model:[t],value:t,options:this.options}),r.on("change",function(e){console.log(e)}));if(r){r.render();var i=$(document.createElement("td"));i.append(r.$el),this.$el.append(i)}return this},remove:function(){return this.$el.remove(),this}}),$("[contenteditable]").live("focus",function(){var e=$(this);return e.data("before",e.html()),e}).live("blur keyup paste",function(){var e=$(this);return e.data("before")!==e.html()&&(e.data("before",e.html()),e.trigger("change")),e}),e.PropertySheetView=Backbone.View.extend({template:_.template('<table class="table table-striped"></table>'),templateTableHead:_.template('<thead><tr><th style="width: 30%"></th><th style="width: 70%"></th></tr></thead>'),templateTableBody:_.template("<tbody></tbody>"),initialize:function(e){this.views=[]},remove:function(){return this.$el&&(this.$el.children().remove(),_.each(this.views,function(e){e.remove()}),this.views.length=0),this},render:function(){if(!this.model||!this.model.eClass)return;this.remove();var e=this.template(),t=this.templateTableHead(),n=this.templateTableBody();return this.$el.append(e),$("table",this.$el).append(t).append(n),this.tbody=$("table > tbody",this.$el),this.renderContent()},createRow:function(t,n,r,i){var s=new e.PropertyRowView({model:{eFeature:t,eObject:n,value:r,options:i}});this.views.push(s)},createFeatureRow:function(e){return this.createRow(e,this.model)},renderRow:function(e){e.render(),this.tbody.append(e.$el)},renderContent:function(){var e=this.model.eClass,t=_.filter(e.get("eAllAttributes"),function(e){return!e.get("derived")}),n=_.filter(e.get("eAllReferences"),function(e){return!e.get("derived")}),r,i;return r=this.model.eResource().get("resourceSet"),r&&(i=r.elements("EClass")),this.createRow("eClass",this.model,this.model.eClass,i),_.each(t,this.createFeatureRow,this),_.each(n,this.createFeatureRow,this),_.each(this.views,this.renderRow,this),this}}),e.TabView=Backbone.View.extend({template:_.template('<li><a href="#tab-<%= id %>" data-toggle="tab"> <%= title %> <i class="icon-remove-circle"></i> </a></li>'),events:{'click a > i[class="icon-remove-circle"]':"remove"},initialize:function(e){this.eid=e.eid,this._rendered=!1},render:function(){if(!this._rendered){var e=this.title(),t=this.template({id:this.eid,title:e});this.setElement(t),this._rendered=!0}return this},remove:function(){this.trigger("remove"),Backbone.View.prototype.remove.apply(this)},title:function(){var e=this.model.get("uri");return e.slice(e.lastIndexOf("/")+1,e.length)}}),e.EditorView=Backbone.View.extend({template:_.template('<div class="tab-pane" id="tab-<%= id %>"></div>'),initialize:function(t){_.bindAll(this,"render","remove"),t&&t.$container&&t.$tabs&&(this.$container=t.container,this.$tabs=t.tabs),this.tab=new e.TabView({eid:this.cid,model:this.model}),this.tab.on("remove",this.remove),this._rendered=!1},render:function(){if(!this._rendered){var e=this.template({id:this.cid});this.setElement(e),this.$container.append(this.$el),this.$tabs.append(this.tab.render().$el),this._rendered=!0}return this.renderContent(),this},renderContent:function(){},show:function(){$('a[href="#tab-'+this.cid+'"]',this.$tabs).tab("show")},remove:function(){this.trigger("remove"),Backbone.View.prototype.remove.apply(this)}}),e.EditorTabView=Backbone.View.extend({template:_.template('<ul class="nav nav-tabs"></ul> <div class="tab-content"></div>'),initialize:function(e){this.editors=[]},render:function(){if(!this.$content&&!this.$tabs){var e=this.template();this.$el.addClass("tabbable"),this.$el.append(e),this.$content=$(".tab-content",this.$el),this.$tabs=$(".nav-tabs",this.$el)}return _.each(this.editors,function(e){e.render()}),this},addEditor:function(e){this.$content&&this.$tabs&&(e.$container=this.$content,e.$tabs=this.$tabs,this.editors.push(e),e.on("remove",function(){this.suppress(e)},this))},getEditor:function(e){return _.find(this.editors,function(t){return t.model===e})},suppress:function(e){this.editors=_.without(this.editors,e)},show:function(e){this.getEditor(e).show()}}),e.TreeNodeView=Backbone.View.extend({template:_.template('<li><div class="<%= kind %>"><div></div><ul></ul></div></li>'),chevronTemplate:_.template('<span class="chevron icon-chevron-right"></span>'),iconTemplate:_.template('<span class="icon-edit-<%= icon %>"> </span>'),labelTemplate:_.template("<span> <%= label %> </span>"),isSelected:!1,isExpanded:!1,events:{'click div span[class~="chevron"]':"expand",click:"select",mouseover:"highlight",mouseout:"unhighlight"},initialize:function(e){_.bindAll(this,"render","expand","select","highlight","unhighlight"),this.children=[],this.tree=e.tree},kind:function(){var e=this.model?this.model.eContents():[];return e.length>0?"tree-node":"tree-leaf"},render:function(){if(!this.model)return this;var t=this.kind();if(!this.$node){var n=this.template({kind:t});this.setElement(n),this.$node=$("div > div",this.$el),this.$children=$("div > ul",this.$el)}this.$node.children().remove(),this.$children.children().remove();var r=this.model.eClass.get("name"),i=e.LabelProvider.getLabel(this.model),s=this.chevronTemplate(),o=this.iconTemplate({icon:r}),u=this.labelTemplate({label:i});return t==="tree-node"&&this.$node.append(s),this.$node.append(o).append(u),this.$chevron=$('span[class~="chevron"]',this.$node),this},highlight:function(e){e&&e.stopImmediatePropagation(),this.$el&&this.$node&&this.$node.addClass("tree-over")},unhighlight:function(e){e&&e.stopImmediatePropagation(),this.$el&&this.$node&&this.$node.removeClass("tree-over")},select:function(e){e&&e.stopImmediatePropagation(),this.$el&&this.$node&&this.$node.addClass("tree-selected"),this.tree.setSelection(this)},deselect:function(){this.$el&&this.$node&&this.$node.removeClass("tree-selected")},addChildren:function(t){if(!t)return;var n=new e.TreeNodeView({model:t,tree:this.tree});return n.render(),this.$children.append(n.$el),this.children.push(n),n},expand:function(e){e&&e.stopImmediatePropagation();if(!this.$children)return this;if(this.isExpanded)this.$children.children().remove(),this.$chevron.removeClass("icon-chevron-down").addClass("icon-chevron-right"),this.children.length=0,this.isExpanded=!1;else{var t=this.model.eContents();if(t.length===0)return this;this.$chevron.removeClass("icon-chevron-right").addClass("icon-chevron-down"),this.$children.children().remove(),this.children.length=0,_.each(t,this.addChildren,this),this.isExpanded=!0}return this}}),e.TreeView=Backbone.View.extend({template:_.template('<div class="tree"><ul></ul></div>'),selected:null,initialize:function(e){this.children=[]},render:function(){if(!this.model)return this;if(!this.$content){var e=this.template();this.setElement(e),this.$children=$("ul",this.$el)}this.$children.children().remove();var t=this.model.eContents();return _.each(t,this.addChildren,this),this.children.length>0&&this.children[0].select(),this},addChildren:function(t){var n=new e.TreeNodeView({model:t,tree:this});return n.render(),this.children.push(n),this.$children.append(n.$el),n},setSelection:function(e){this.selected&&(this.selected.deselect(),this.trigger("deselect",this.selected)),this.selected=e,this.trigger("select",this.selected)}})})();