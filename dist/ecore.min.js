(function(){function s(e){var r=e.eClass;if(!r)return;var i=r.get("eAllStructuralFeatures");t.each(i,function(t){var r=t.get("name");if(r){var i=t.values.defaultValue,s=t.get("upperBound"),u=t.values.derived===!0,a=t.values.containment===!0,f=e.values[r];if(f===null||f===undefined)u?e.values[r]=t.values._:s===1||!s?o(e,r,i):f instanceof n.EList?f._setFeature(t):e.values[r]=t.isTypeOf("EAttribute")?[]:new n.EList(e,t)}})}function o(e,t,n){var r;n===null||n===undefined?r=null:n===0?r=0:n===!1?r=!1:r=n,e.values[t]=r}function u(e,n){return t.find(e.get("eAllStructuralFeatures"),function(e){return e.values.name===n})}function a(e,r){if(!e.eClass)return;t.each(r,function(e,r){var s=u(this.eClass,r),o=[];s&&(s.isTypeOf("EReference")&&(t.isArray(e)?t.each(e,function(e){o.push(e instanceof i?e:n.create(e))}):!e instanceof i&&(e=n.create(e))),s.get("upperBound")===1||!s.get("upperBound")?this.set(r,e):this.get(r).addAll(o))},e)}function f(e){var n=e.get("eOperations").array(),r=e.get("eAllSuperTypes"),i=t.flatten(t.union(n||[],t.map(r||[],function(e){return f(e)})));return i}function l(e){if(!e||!e.eClass)return;var n=f(e.eClass);if(!n)return;t.each(n,function(t){e[t.get("name")]=t._})}function kt(e){var n={},r=e.get("contents").array();if(r.length===1){var i=r[0],s=function(e,r){var i=e.eContents();n[r]=e,t.each(i,function(e){s(e,e.fragment())})},o=i.eClass.get("eIDAttribute")||null;o?s(i,i.get(o.name)):s(i,"/")}return n}function At(e){var t=/(>)(<)(\/*)/g,n=/ *(.*) +\n/g,r=/(<.+>)(.+\n)/g;e=e.replace(t,"$1\n$2$3").replace(n,"$1\n").replace(r,"$1\n$2");var i=0,s="",o=e.split("\n"),u=0,a="other",f={"single->single":0,"single->closing":-1,"single->opening":0,"single->other":0,"closing->single":0,"closing->closing":-1,"closing->opening":0,"closing->other":0,"opening->single":1,"opening->closing":0,"opening->opening":1,"opening->other":1,"other->single":0,"other->closing":-1,"other->opening":0,"other->other":0};for(var l=0;l<o.length;l++){var c=o[l],h=Boolean(c.match(/<.+\/>/)),p=Boolean(c.match(/<\/.+>/)),d=Boolean(c.match(/<[^!].*>/)),v=h?"single":p?"closing":d?"opening":"other",m=a+"->"+v;a=v;var g="";u+=f[m];for(var y=0;y<u;y++)g+="    ";s+=g+c+"\n"}return s}var e=this,t=e._||require("underscore"),n={create:function(e,t){var n,r;return t?(n=t,n.eClass=e):e instanceof i?(n={},n.eClass=e):n=e,r=new i(n),r}};n.version="0.3.0",typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=n),exports.Ecore=n):e.Ecore=n;var r={on:function(e,t,n){var r,i,s;if(!t)return this;e=e.split(/\s+/),r=this._callbacks||(this._callbacks={});while(i=e.shift())s=r[i]||(r[i]=[]),s.push(t,n);return this},off:function(e,n,r){var i,s,o,u;if(!(s=this._callbacks))return this;if(!(e||n||r))return delete this._callbacks,this;e=e?e.split(/\s+/):t.keys(s);while(i=e.shift()){if(!(o=s[i])||!n&&!r){delete s[i];continue}for(u=o.length-2;u>=0;u-=2)n&&o[u]!==n||r&&o[u+1]!==r||o.splice(u,2)}return this},trigger:function(e){var t,n,r,i,s,o,u,a;if(!(n=this._callbacks))return this;a=[],e=e.split(/\s+/);for(i=1,s=arguments.length;i<s;i++)a[i-1]=arguments[i];while(t=e.shift()){if(u=n.all)u=u.slice();if(r=n[t])r=r.slice();if(r)for(i=0,s=r.length;i<s;i+=2)r[i].apply(r[i+1]||this,a);if(u){o=[t].concat(a);for(i=0,s=u.length;i<s;i+=2)u[i].apply(u[i+1]||this,o)}}return this}},i=function(e){return e||(e={}),this.eClass=e.eClass,this.values={},e._&&(this._=e._),s(this),a(this,e),l(this),this};n.EObjectPrototype={setEClass:function(e){return this.eClass=e,s(this),a(this,this.values),l(this),this},create:function(e){if(this.eClass.get("name")!=="EClass")return;return n.create(this,e)},has:function(e){return this.values.hasOwnProperty(e)||u(this.eClass,e)},isSet:function(e){if(!this.has(e))return!1;var t=this.eClass;if(!t)return!1;var n=this.get(e);return n instanceof c?n.size()>0:n!==null&&typeof n!="undefined"},set:function(e,n){var r,i,s;if(e===null)return this;t.isObject(e)||(i=e,(e={})[i]=n,n=arguments[2]);for(r in e)s=e[r],typeof s!="undefined"&&this.has(r)&&(this.values[r]=s,this.trigger("change",r));return this},get:function(e){var t=this.values[e];return typeof t=="function"?t.apply(this):t},isTypeOf:function(e){if(!e||!this.eClass)return!1;var t=e.eClass?e.get("name"):e;return this.eClass.get("name")===t},isKindOf:function(e){if(!e||!this.eClass)return!1;if(this.isTypeOf(e))return!0;var n=e.eClass?e.get("name"):e,r=this.eClass.get("eAllSuperTypes");return t.any(r,function(e){return e.get("name")===n})},eResource:function(){return this.eContainer?this.eContainer.isTypeOf("Resource")?this.eContainer:this.eContainer.eResource():this.isTypeOf("Resource")?this:null},eContents:function(){if(!this.eClass)return[];var e=this.eClass.get("eAllStructuralFeatures"),r=t.filter(e,function(e){return e.isTypeOf("EReference")&&e.get("containment")&&this.isSet(e.get("name"))},this);return t.flatten(t.map(r,function(e){var t=this.get(e.get("name"));return t instanceof n.EList?t.array():t},this))},eURI:function(){var e=this.eResource(),t=this;return e.get("uri")+"#"+this.fragment()},fragment:function(){var e=this.eContainer,t=this.eClass,n=t.get("eIDAttribute");if(!e)return null;if(n)return this.get(n.get("name"));if(this.isKindOf("EModelElement"))return!e||e.isKindOf("Resource")?"/":e.fragment()+"/"+this.get("name");var r;if(this.eContainer.isKindOf("Resource"))r="/";else{var i=this.eContainingFeature;if(i){r=this.eContainer.fragment()+"/@"+i.get("name");if(i.get("upperBound")!==1){var s=this.eContainer.get(i.get("name")).indexOf(this);r+="."+s}}}return r}},t.extend(i.prototype,n.EObjectPrototype,r);var c=n.EList=function(e,t){return this._internal=[],this._owner=e,this._size=0,this._setFeature(t),this};c.prototype={_setFeature:function(e){e&&(this._feature=e,this._isContainment=this._feature.get("containment"),t.each(this._internal,function(e){this._isContainment&&(e.eContainer=this._owner,e.eContainingFeature=this._feature)},this))},add:function(e){return!e||!e instanceof i?this:(this._isContainment&&(e.eContainingFeature=this._feature,e.eContainer=this._owner),this._size++,this._internal.push(e),this._owner.trigger("change",e),this)},addAll:function(){return t.each(t.flatten(arguments||[]),function(e){this.add(e)},this),this},remove:function(e){return this._internal=t.without(this._internal,e),this._size=this._size-1,this},size:function(){return this._size},at:function(e){if(this._size<e)throw new Error("Index Out Of Range");return this._internal[e]},array:function(){return this._internal},first:function(){return t.first(this._internal)},last:function(){return t.last(this._internal)},rest:function(e){return t.rest(this._internal,e)},each:function(e,n){return t.each(this._internal,e,n)},filter:function(e,n){return t.filter(this._internal,e,n)},find:function(e,n){return t.find(this._internal,e,n)},map:function(e,n){return t.map(this._internal,e,n)},reject:function(e,n){return t.reject(this._internal,e,n)},contains:function(e){return t.contains(this._internal,e)},indexOf:function(e){return t.indexOf(this._internal,e)}};var h=new i,p=new i,d=new i,m=new i,g=new i,y=new i,b=new i,w=new i,E=new i,S=new i,x=new i,T=new i;h.eClass=h,h.values={name:"EClass","abstract":!1,"interface":!1,eStructuralFeatures:new n.EList(h),eOperations:new n.EList(h),eSuperTypes:new n.EList(h),eAllSuperTypes:function(){var e,n;return e=this.get("eSuperTypes")._internal,n=t.union(e||[],t.flatten(t.map(e||[],function(e){return e.get("eAllSuperTypes")}))),t.isArray(n)?n:[]},eAllSubTypes:function(){var e,r;return e=n.EPackage.Registry.elements("EClass"),r=t.filter(e,function(e){return t.contains(e.get("eAllSuperTypes"),this)},this),t.isArray(r)?r:[]},eReferences:function(){var e,t;return e=this.get("eStructuralFeatures"),t=e.filter(function(e){return e.isTypeOf("EReference")}),t},eAttributes:function(){var e,t;return e=this.get("eStructuralFeatures"),t=e.filter(function(e){return e.isTypeOf("EAttribute")}),t},eIDAttribute:function(){var e,n;return e=this.get("eAllAttributes"),n=t.filter(e,function(e){return e.get("iD")===!0}),t.isArray(n)?null:n},eAllStructuralFeatures:function(){var e,n,r;return e=this.get("eAllSuperTypes"),n=t.flatten(t.map(e||[],function(e){return e.get("eAllStructuralFeatures")})),r=t.union(n||[],this.get("eStructuralFeatures")._internal),t.isArray(r)?r:[]},eAllAttributes:function(){var e,n,r;return e=this.get("eAllSuperTypes"),n=t.flatten(t.map(e||[],function(e){return e.get("eAllAttributes")})),r=t.union(n||[],t.filter(this.get("eStructuralFeatures")._internal,function(e){return e.isTypeOf("EAttribute")})),t.isArray(r)?r:[]},eAllContainments:function(){var e,n,r;return e=this.get("eAllSuperTypes"),n=t.flatten(t.map(e||[],function(e){return e.get("eAllContainments")})),r=t.union(n||[],t.filter(this.get("eStructuralFeatures")._internal,function(e){return e.isTypeOf("EReference")&&e.get("containment")})),t.isArray(r)?r:[]},eAllReferences:function(){var e,n,r;return e=this.get("eAllSuperTypes"),n=t.flatten(t.map(e||[],function(e){return e.get("eAllReferences")})),r=t.union(n||[],t.filter(this.get("eStructuralFeatures")._internal,function(e){return e.isTypeOf("EReference")&&!e.get("containment")})),t.isArray(r)?r:[]}},w.values={name:"abstract",lowerBound:0,upperBound:1,defaultValueLiteral:"false",defaultValue:!1,eType:m},E.values={name:"interface",lowerBound:0,upperBound:1,defaultValueLiteral:"false",defaultValue:!1,eType:m},S.values={name:"eStructuralFeatures",lowerBound:0,upperBound:-1,containment:!0},T.values={name:"eSuperTypes",lowerBound:0,upperBound:-1,containment:!1},x.values={name:"eOperations",lowerBound:0,upperBound:-1,containment:!0},h.get("eStructuralFeatures").add(w).add(E).add(T).add(S).add(x);var N=new i;N.values={name:"eAllStructuralFeatures",lowerBound:0,upperBound:-1,derived:!0,containment:!1,_:h.values.eAllStructuralFeatures};var C=new i;C.values={name:"eAllSuperTypes",lowerBound:0,upperBound:-1,derived:!0,containment:!1,_:h.values.eAllSuperTypes};var k=new i;k.values={name:"eAllSubTypes",lowerBound:0,upperBound:-1,derived:!0,containment:!1,_:h.values.eAllSubTypes};var L=new i;L.values={name:"eAllAttributes",lowerBound:0,upperBound:-1,derived:!0,containment:!1,_:h.values.eAllAttributes};var A=new i;A.values={name:"eAllContainments",lowerBound:0,upperBound:-1,derived:!0,containment:!1,_:h.values.eAllContainments};var O=new i;O.values={name:"eAllReferences",lowerBound:0,upperBound:-1,derived:!0,containment:!1,_:h.values.eAllReferences};var M=new i;M.values={name:"eReferences",lowerBound:0,upperBound:-1,derived:!0,containment:!1,_:h.values.eReferences};var _=new i;_.values={name:"eAttributes",lowerBound:0,upperBound:-1,derived:!0,containment:!1,_:h.values.eAttributes};var D=new i;D.values={name:"eIDAttribute",lowerBound:0,upperBound:1,derived:!0,containment:!1,_:h.values.eIDAttribute},h.get("eStructuralFeatures").add(N).add(C).add(k).add(L).add(O).add(A).add(_).add(M).add(D),h.getEStructuralFeature=function(e){var n;return n=e.eClass?e.get("name"):e,t.find(this.get("eAllStructuralFeatures"),function(e){return e.get("name")===n})};var P=new i;P.values={name:"getEStructuralFeature",lowerBound:0,upperBound:1,eParameters:new n.EList(this)},P._=h.getEStructuralFeature,h.get("eOperations").add(P),h.values.eStructuralFeatures._setFeature(S),h.values.eSuperTypes._setFeature(T),h.values.eOperations._setFeature(x);var H=h.create(),B=h.create(),j=h.create(),F=h.create(),I=h.create(),q=h.create(),R=h.create(),U=h.create(),z=h.create(),W=h.create(),X=h.create(),V=h.create(),$=h.create(),J=h.create(),K=h.create();w.eClass=X,E.eClass=X,S.eClass=V,S.values.eType=W,T.eClass=V,T.values.eType=h,x.eClass=V,x.values.eType=$,N.eClass=V,N.values.eType=W,C.eClass=V,C.values.eType=h,k.eClass=V,k.values.eType=h,L.eClass=V,L.values.eType=X,O.eClass=V,O.values.eType=V,A.eClass=V,A.values.eType=V,_.eClass=V,_.values.eType=X,M.eClass=V,M.values.eType=V,D.eClass=V,D.values.eType=X,P.eClass=$,P.values.eType=W,B.get("eSuperTypes").add(H),j.get("eSuperTypes").add(B),F.get("eSuperTypes").add(B),I.get("eSuperTypes").add(F),q.get("eSuperTypes").add(F),h.get("eSuperTypes").add(q),R.get("eSuperTypes").add(q),U.get("eSuperTypes").add(R),K.get("eSuperTypes").add(F),z.get("eSuperTypes").add(F),W.get("eSuperTypes").add(z),X.get("eSuperTypes").add(W),V.get("eSuperTypes").add(W),$.get("eSuperTypes").add(z),J.get("eSuperTypes").add(z);var Q=new i,G=new i,Y=new i,Z=new i,et=new i,tt=new i,nt=new i;Q.eClass=V,Q.values={name:"eType",lowerBound:0,upperBound:1,containment:!1,eType:q},G.eClass=X,G.values={name:"ordered",lowerBound:0,upperBound:1,defaultValueLiteral:"true",defaultValue:!0,eType:m},Y.eClass=X,Y.values={name:"unique",lowerBound:0,upperBound:1,defaultValueLiteral:"true",defaultValue:!0,eType:m},Z.eClass=X,Z.values={name:"lowerBound",lowerBound:0,upperBound:1,defaultValueLiteral:"0",defaultValue:0,eType:d},et.eClass=X,et.values={name:"upperBound",lowerBound:0,upperBound:1,defaultValueLiteral:"1",defaultValue:1,eType:d},tt.eClass=X,tt.values={name:"many",lowerBound:0,upperBound:1,eType:m,derived:!0,_:function(){return this.get("upperBound")!==1}},nt.eClass=X,nt.values={name:"required",lowerBound:0,upperBound:1,eType:m,derived:!0,_:function(){return this.get("lowerBound")===1}},z.get("eStructuralFeatures").add(Q).add(G).add(Y).add(Z).add(et).add(tt).add(nt);var rt=new i;rt.eClass=X,rt.values={name:"name",lowerBound:0,upperBound:1,eType:p},F.get("eStructuralFeatures").add(rt);var it=X.create({name:"changeable",eType:m}),st=X.create({name:"volatile",eType:m}),ot=X.create({name:"transient",eType:m}),ut=X.create({name:"defaultValueLiteral",eType:p}),at=X.create({name:"defaultValue",eType:b,derived:!0}),ft=X.create({name:"unsettable",eType:m}),lt=X.create({name:"derived",eType:m});W.get("eStructuralFeatures").add(it).add(st).add(ot).add(ut).add(at).add(ft).add(lt),at.set({derived:!0});var ct=X.create({name:"containment",eType:m}),ht=X.create({name:"container",eType:m}),pt=X.create({name:"resolveProxies",eType:m}),dt=V.create({name:"eOpposite",eType:V});V.get("eStructuralFeatures").add(ct).add(ht).add(pt).add(dt);var vt=X.create({name:"iD",eType:m});X.get("eStructuralFeatures").add(vt),H.set({name:"EObject"}),B.set({name:"EModelElement","abstract":!0}),j.set({name:"EAnnotation"}),F.set({name:"ENamedElement","abstract":!0}),I.set({name:"EPackage"}),q.set({name:"EClassifier","abstract":!0}),R.set({name:"EDataType"}),U.set({name:"EEnum"}),z.set({name:"ETypedElement","abstract":!0}),W.set({name:"EStructuralFeature","abstract":!0}),X.set({name:"EAttribute"}),V.set({name:"EReference"}),$.set({name:"EOperation"}),J.set({name:"EParameter"}),K.set({name:"EEnumLiteral"});var mt=V.create({name:"eParameters",eType:J,containment:!0,lowerBound:0,upperBound:-1});$.get("eStructuralFeatures").add(mt);var gt=V.create({name:"eLiterals",eType:K,containment:!0,lowerBound:0,upperBound:-1});U.get("eStructuralFeatures").add(gt),EEnumLiteral_value=X.create({name:"value",eType:d}),EEnumLiteral_literal=X.create({name:"literal",eType:p}),K.get("eStructuralFeatures").add(EEnumLiteral_literal).add(EEnumLiteral_value),p.eClass=R,p.set({name:"EString"}),d.eClass=R,d.set({name:"EInteger"}),m.eClass=R,m.set({name:"EBoolean"}),y.eClass=R,y.set({name:"EDate"}),g.eClass=R,g.set({name:"EDouble"}),b.eClass=R,b.set({name:"JSObject"}),n.ELong=R.create({name:"ELong"}),n.EFloat=R.create({name:"EFloat"}),n.EShort=R.create({name:"EShort"});var yt=V.create({name:"eClassifiers",lowerBound:0,upperBound:-1,containment:!0,eType:q}),bt=V.create({name:"eSubPackages",lowerBound:0,upperBound:-1,containment:!0,eType:I});I.get("eStructuralFeatures").add(X.create({name:"nsURI",eType:p})).add(X.create({name:"nsPrefix",eType:p})).add(yt).add(bt),n.EcorePackage=I.create({name:"ecore",nsPrefix:"ecore",nsURI:"http://www.eclipse.org/emf/2002/Ecore"}),n.EcorePackage.get("eClassifiers").add(H).add(B).add(j).add(F).add(I).add(q).add(h).add(R).add(z).add(W).add(X).add(V).add($).add(J).add(U).add(K).add(p).add(m).add(d).add(g).add(y).add(n.EShort).add(n.EFloat).add(n.ELong).add(b),n.EObject=H,n.EModelElement=B,n.EClass=h,n.EClassifier=q,n.EAnnotation=j,n.EPackage=I,n.ETypedElement=z,n.ENamedElement=F,n.EStructuralFeature=W,n.EAttribute=X,n.EReference=V,n.EEnum=U,n.EEnumLiteral=K,n.EDataType=R,n.EOperation=$,n.EParameter=J,n.EString=p,n.EBoolean=m,n.EInteger=d,n.EDouble=g,n.EDate=y,n.JSObject=b,n.EPackage.Registry={_ePackages:{},getEPackage:function(e){return this._ePackages[e]},register:function(e){if(!e.isSet("nsURI"))throw new Error("Cannot register EPackage without nsURI");this._ePackages[e.get("nsURI")]=e},ePackages:function(){return t.values(this._ePackages)},elements:function(e){var n=function(t){return e?e.eClass?t.eClass===e:t.eClass.get("name")===e:!0},r=this.ePackages(),i=function(e){return t.map(e.eContents(),function(e){return[e,i(e)]})},s=function(e){return i(e)},o=[r,t.map(r,s)];return o=t.flatten(o),o=t.filter(o,n),o}},n.EPackage.Registry.register(n.EcorePackage),n.$=e.jQuery||e.Zepto||e.ender||null;var wt={get:function(e,t,r,i){if(!n.$)return;return n.$.ajax({url:e,dataType:t,success:r,error:i})},post:function(e,t,r,i,s){if(!n.$)return;return n.$.ajax({type:"POST",url:e,dataType:r,data:t,success:i,error:s})}};n.JSON={dataType:"json",contentType:"application/json",parse:function(e,r){function o(e,n){return!e||!n?function(e){}:function(r){if(r.get("derived"))return;var s=r.get("name"),o=e[s];typeof o!="undefined"&&(r.isTypeOf("EAttribute")?n.set(s,o):r.get("containment")?r.get("upperBound")===1?n.set(s,f(o)):t.each(o||[],function(e){n.get(s).add(f(e))}):i.push({parent:n,feature:r,value:o}))}}function u(e){return e.substring(0,1)==="/"}function a(){function r(e,t,r,i){var o=r.$ref,a;u(o)?a=n[o]:a=s.getEObject(o),a&&(i?e.get(t.get("name")).add(a):e.set(t.get("name"),a))}var n=kt(e);t.each(i,function(e){var n=e.parent,i=e.feature,s=e.value;i.get("upperBound")===1?r(n,i,s,!1):t.each(s,function(e){r(n,i,e,!0)})})}function f(e){var r;if(e&&e.eClass){var i=s.getEObject(e.eClass),u=i.get("eAllStructuralFeatures");r=n.create(i),t.each(u,o(e,r))}return r}var i=[],s=e.get("resourceSet")||n.ResourceSet.create(),l=f(r);l&&(e.add(l),a())},to:function(e){function i(e,t){var n=t.eResource(),i=e.eResource(),s=n!==i;if(!n||!i)return;r[n.get("uri")]||(r[n.get("uri")]=kt(n));var o=r[n.get("uri")];for(var u in o)if(o[u]===t)return s?n.get("uri")+"#"+u:u;return null}function s(e,t,n){return n===!0?u(t):{$ref:i(e,t),eClass:t.eClass.eURI()}}function o(e,t){return!e||!t?function(){}:function(n,r){if(r[0]==="_")return;var i=e.eClass.getEStructuralFeature(r),o=e.isSet(r);if(!i||!o||i.get("derived"))return;var u=n,a=i.get("name"),f=i.get("upperBound")!==1,l=i.get("containment");i.isTypeOf("EAttribute")?t[a]=u:f?(t[a]=[],u.each(function(n){t[a].push(s(e,n,l))})):t[a]=s(e,u,l)}}function u(e){var n=e.eClass,r=e.values,i={eClass:n.eURI()};return t.each(r,o(e,i)),i}var n=e.get("contents").array(),r={};r[e.get("uri")]=kt(e);var a;if(n.length===1){var f=n[0];a=u(f)}return a}};var Et=n.Resource=n.EClass.create({name:"Resource",eSuperTypes:[n.EObject],eStructuralFeatures:[{eClass:n.EAttribute,name:"uri",lowerBound:1,upperBound:1,eType:n.EString},{eClass:n.EReference,name:"contents",upperBound:-1,containment:!0,eType:n.EObject},{eClass:n.EReference,name:"resourceSet",upperBound:1,lowerBound:0,eType:n.ResourceSet}],eOperations:[{eClass:n.EOperation,name:"clear",_:function(){this.get("contents").clear()}},{eClass:n.EOperation,name:"add",_:function(e){return t.isObject(e)?(e.eContainer=this,this.get("contents").add(e),this):this}},{eClass:n.EOperation,name:"clear",_:function(){return this.get("contents").clear(),this}},{eClass:n.EOperation,name:"add",_:function(e){return e&&(e.eContainer=this,this.get("contents").add(e)),this}},{eClass:n.EOperation,name:"addAll",_:function(e){return t.isArray(e)&&t.each(e,function(e){this.add(e)},this),this}},{eClass:n.EOperation,name:"getEObject",eType:n.EObject,_:function(e){return e?kt(this)[e]:null}},{eClass:n.EOperation,name:"each",_:function(e,t){return this.get("contents").each(e,t)}},{eClass:n.EOperation,name:"to",_:function(e,t){return e&&typeof e.to=="function"?e.to(this,t):n.JSON.to(this)}},{eClass:n.EOperation,name:"parse",_:function(e,t){return t&&typeof t.parser=="function"?t.parse(this,e):n.JSON.parse(this,e),this}},{eClass:n.EOperation,name:"save",_:function(e,t,n){var r=this.to(n),i=n?n.dataType:"json";r&&wt.post(this.uri,r,format,e,t)}},{eClass:n.EOperation,name:"load",_:function(e,t,n,r){var i=this,s=function(t){return i.parse(t,r),e(i)};return n?s(n):wt.get(this.uri,"json",s,t)}},{eClass:n.EOperation,name:"_index",eType:b,_:function(){return kt(this)}}]}),St=function(){this.uriMap={}};St.prototype={map:function(e,t){this.uriMap[e]=t},normalize:function(e){var t=e.split("#"),n=t[0],r=this.uriMap[n];if(r)return r;var i=n.lastIndexOf("/")+1,s,o;return s=n.slice(0,i),s===n?e:(o=n.slice(i,n.length),this.normalize(s)+o)}};var xt=n.ResourceSet=n.EClass.create({name:"ResourceSet",eSuperTypes:[n.EObject],eStructuralFeatures:[{eClass:n.EReference,name:"resources",upperBound:-1,containment:!0,eType:Et}],eOperations:[{eClass:n.EOperation,eType:n.Resource,upperBound:1,name:"create",_:function(e){var r=t.isObject(e)?e:{uri:e},i,s;if(!r.uri)throw new Error("Cannot create Resource, missing URI parameter");return s=this.get("resources").find(function(e){return e.get("uri")===r.uri}),s?s:(i=n.EPackage.Registry.getEPackage(r.uri),i?(i.eResource()?s=i.eResource():(s=n.Resource.create(r),s.add(i),s.set("resourceSet",this),this.get("resources").add(s)),s):(s=n.Resource.create(r),s.set("resourceSet",this),this.get("resources").add(s),s))}},{eClass:n.EOperation,eType:n.EObject,upperBound:1,name:"getEObject",_:function(e){var t=e.split("#"),r=t[0],i=t[1],s;if(!i)return null;s=this.get("resources").find(function(e){return e.get("uri")===r});if(!s){var o=n.EPackage.Registry.getEPackage(r);if(o){if(!o.eResource()){var u=this.create({uri:r});u.add(o)}return o.eResource().set("resourceSet",this),this.get("resources").add(o.eResource()),this.getEObject(e)}return null}return s.getEObject(i)}},{eClass:n.EOperation,eType:n.EObject,upperBound:-1,name:"elements",_:function(e){var n=function(t){return e?e.eClass?v.eClass===e:v.eClass.get("name")===e:!0},r=this.get("resources"),i=t.flatten(t.map(r,function(e){return t.filter(t.values(e._index()),n)}));return i}},{eClass:n.EOperation,eType:n.JSObject,upperBound:1,name:"uriConverter",_:function(){return this._converter||(this._converter=new St),this._converter}}]}),Tt=n.EPackage.create({name:"resources",nsPrefix:"resources",nsURI:"http://www.eclipselabs.org/ecore/2012/resources",eClassifiers:[xt,Et]}),Nt=n.Resource.create({uri:n.EcorePackage.get("nsURI")});Nt.add(n.EcorePackage);var Ct=n.Resource.create({uri:Tt.get("nsURI")});Ct.add(Tt),n.EPackage.Registry.register(Tt);var Lt=e.sax||require("sax");n.XMI={dataType:"xml",contentType:"application/xml",parse:function(e,r){function a(e){if(!e)return;t.each(e,function(e,t){if(t.indexOf(":")!==-1){var n=t.split(":");n[0]==="xmlns"&&o.push({prefix:n[1],uri:e})}})}function f(e){var n=t.find(o,function(t){return t.prefix===e});return n?n.uri:null}function l(e){if(e.indexOf(":")!==-1){var t=e.split(":"),n=t[0],r=t[1],i=f(n)+"#//"+r;return s.getEObject(i)}if(c.parent.eObject){var o=c.parent.eObject,u=o.eClass.getEStructuralFeature(e),a=u.get("eType");return a}}function d(){function r(e){return e.substring(0,1)==="/"}function i(e,i,o){var u=o.split(/\s/),a=i.get("upperBound")!==1,f;t.each(u,function(t){r(t)?f=n[t]:f=s.getEObject(t),f&&(a?e.get(i.get("name")).add(f):e.set(i.get("name"),f))})}var n=e._index();t.each(p,function(e){var t=e.parent,n=e.feature,r=e.value;i(t,n,r)})}var i=Lt.parser(!0),s=e.get("resourceSet")||n.ResourceSet.create(),o=[],u,c,h,p=[];i.onopentag=function(e){var r,i,s,o;a(e.attributes),e.children=[],e.parent=c,e.parent&&e.parent.children.push(e),c=e,r=l(e.name),r&&(i=c.eObject=n.create(r),h||(h=i),t.each(e.attributes,function(e,t){i.has(t)&&(s=i.eClass.getEStructuralFeature(t),s.isTypeOf("EAttribute")?i.set(t,e):p.push({parent:i,feature:s,value:e}))}),e.parent&&(o=e.parent.eObject,o.has(e.name)&&(s=o.eClass.getEStructuralFeature(e.name),s.get("upperBound")===1?o.set(e.name,i):o.get(e.name).add(i))))},i.onclosetag=function(e){var t;c&&c.parent&&(t=c.parent,delete c.parent,c=t)},i.write(r).close(),e.add(h),d()},to:function(e,r){function f(e){i+="<";var r;e.eContainingFeature&&e.eContainingFeature!==a?r=e.eContainingFeature.get("name"):r=o+":"+e.eClass.get("name"),i+=r,e.eContainer.isKindOf("Resource")&&(i+=' xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI"',i+=' xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"',i+=" xmlns:"+o+'="'+u+'"'),e.eContainingFeature.get("eType").get("abstract")&&(i+=' xsi:type="',i+=o+":"+e.eClass.get("name")+'"');var s=e.eClass.get("eAllStructuralFeatures"),l=t.filter(s,function(t){return!t.get("derived")&&t.isTypeOf("EAttribute")&&e.isSet(t.get("name"))}),c=t.filter(s,function(t){return!t.get("derived")&&t.isTypeOf("EReference")&&!t.get("containment")&&e.isSet(t.get("name"))});t.each(l,function(t){var n=t.get("name"),r=e.get(n);r!==!1&&r!=="false"&&(i+=" "+n+'="'+r+'"')});var h=[];t.each(c,function(r){var s=e.get(r.get("name")),o=s instanceof n.EList?s.array():s?[s]:[],u=t.filter(o,function(t){return t.eResource()!==e.eResource()});u.length&&h.push({feature:r,refs:u});var a=t.difference(o,u),f=t.map(a,function(e){return e.fragment()});f.length&&(i+=" "+r.get("name")+'="'+f.join(" ")+'"')});if(e.eContents().length===0&&h.length===0)i+="/>";else{i+=">",t.each(h,function(e){var n=e.feature,r=e.refs,s=n.get("eType").get("abstract");t.each(r,function(e){i+="<"+n.get("name"),s&&(i+=' xsi:type="'+e.eClass.get("name")+'"'),i+=' href="'+e.eURI()+'"'+" />"})});var p=t.filter(s,function(t){return t.isTypeOf("EReference")&&t.get("containment")&&e.isSet(t.get("name"))});t.each(p,function(t){var n=e.get(t.get("name"));t.get("upperBound")!==1?n.each(function(e){f(e)}):f(n)}),i+="</"+r+">"}return i}var i="",s=e.get("contents").first(),o=s.eClass.eContainer.get("nsPrefix"),u=s.eClass.eContainer.get("nsURI"),a=n.Resource.getEStructuralFeature("contents");return f(s),i=r?At(i):i,i='<?xml version="1.0" encoding="UTF-8"?>\n'+i,i}}})();